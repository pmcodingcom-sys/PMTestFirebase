<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Firebase CRUD 2026</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --primary: #4361ee;
            --success: #4cc9f0;
            --danger: #f72585;
            --bg: #f8f9fa;
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        /* --- Loader Styles --- */
        #loader-wrapper {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.8);
            display: flex; justify-content: center; align-items: center;
            z-index: 9999; visibility: hidden; opacity: 0;
            transition: 0.3s;
        }
        #loader-wrapper.active { visibility: visible; opacity: 1; }
        .spinner {
            width: 50px; height: 50px;
            border: 5px solid #ddd; border-top: 5px solid var(--primary);
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- UI Styles --- */
        .app-card {
            background: white; width: 100%; max-width: 500px;
            padding: 30px; border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }

        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { margin: 0; color: var(--primary); font-weight: 500; }

        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        input {
            flex: 1; padding: 12px 15px; border: 2px solid #eee;
            border-radius: 12px; outline: none; font-family: 'Kanit';
            transition: 0.3s;
        }
        input:focus { border-color: var(--primary); }

        .btn {
            padding: 12px 20px; border: none; border-radius: 12px;
            cursor: pointer; font-family: 'Kanit'; font-weight: 500;
            transition: 0.3s; display: flex; align-items: center; gap: 5px;
        }
        .btn-add { background: var(--primary); color: white; }
        .btn-add:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(67,97,238,0.3); }

        ul { list-style: none; padding: 0; }
        li {
            background: #fff; border: 1px solid #f0f0f0; padding: 15px;
            border-radius: 15px; margin-bottom: 12px;
            display: flex; justify-content: space-between; align-items: center;
            transition: 0.3s;
        }
        li:hover { transform: scale(1.02); box-shadow: 0 5px 15px rgba(0,0,0,0.03); }

        .item-text { font-size: 1.1rem; color: #444; }
        .actions { display: flex; gap: 8px; }
        .btn-edit { background: #fff; color: var(--success); border: 1px solid var(--success); }
        .btn-delete { background: #fff; color: var(--danger); border: 1px solid var(--danger); }
        .btn-edit:hover { background: var(--success); color: white; }
        .btn-delete:hover { background: var(--danger); color: white; }
    </style>
</head>
<body>

    <div id="loader-wrapper">
        <div class="spinner"></div>
    </div>

    <div class="app-card">
        <div class="header">
            <h1><i class="fa-solid fa-layer-group"></i> My Data Hub</h1>
            <p>ระบบจัดการข้อมูลแบบ Real-time</p>
        </div>

        <div class="input-group">
            <input type="text" id="itemName" placeholder="เพิ่มรายการใหม่...">
            <button class="btn btn-add" onclick="addItem()">
                <i class="fa-solid fa-plus"></i> เพิ่ม
            </button>
        </div>

        <ul id="itemList">
            </ul>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, deleteDoc, updateDoc, serverTimestamp } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // 1. ใส่ Config ของคุณตรงนี้
        const firebaseConfig = {
            apiKey: "AIzaSyAHKKk7gGiXWpCQ__iVb5zC7pN-DndYcRw",
            authDomain: "pmcoding-d6006.firebaseapp.com",
            projectId: "pmcoding-d6006",
            storageBucket: "pmcoding-d6006.firebasestorage.app",
            messagingSenderId: "393268229281",
            appId: "1:393268229281:web:1708e1c4622af894222ce0",
            measurementId: "G-264D575CB6"
          };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const itemsCol = collection(db, "study_items");

        // ฟังก์ชันช่วยเปิด/ปิด Loader
        const toggleLoader = (show) => {
            const loader = document.getElementById('loader-wrapper');
            show ? loader.classList.add('active') : loader.classList.remove('active');
        };

        // --- [CREATE] เพิ่มข้อมูล ---
        window.addItem = async () => {
            const input = document.getElementById('itemName');
            if (!input.value.trim()) return;

            toggleLoader(true);
            try {
                await addDoc(itemsCol, {
                    name: input.value,
                    createdAt: serverTimestamp() // ใช้เวลาจาก Server แม่นยำที่สุด
                });
                input.value = "";
            } catch (error) {
                Swal.fire('Error', error.message, 'error');
            } finally {
                toggleLoader(false);
            }
        };

        // --- [READ] ดึงข้อมูลแบบ Real-time ---
        const q = query(itemsCol, orderBy("createdAt", "desc"));
        onSnapshot(q, (snapshot) => {
            const list = document.getElementById('itemList');
            list.innerHTML = "";
            
            if (snapshot.empty) {
                list.innerHTML = "<p style='text-align:center; color:#aaa;'>ไม่มีข้อมูลในระบบ</p>";
                return;
            }

            snapshot.forEach((item) => {
                const data = item.data();
                const li = document.createElement('li');
                li.innerHTML = `
                    <span class="item-text">${data.name}</span>
                    <div class="actions">
                        <button class="btn btn-edit" onclick="editItem('${item.id}', '${data.name}')">
                            <i class="fa-solid fa-pen"></i>
                        </button>
                        <button class="btn btn-delete" onclick="deleteItem('${item.id}')">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                `;
                list.appendChild(li);
            });
        });

        // --- [UPDATE] แก้ไขข้อมูล ---
        window.editItem = async (id, currentName) => {
            const { value: newName } = await Swal.fire({
                title: 'แก้ไขข้อมูล',
                input: 'text',
                inputValue: currentName,
                showCancelButton: true,
                inputValidator: (value) => { if (!value) return 'กรุณากรอกข้อมูล!' }
            });

            if (newName && newName !== currentName) {
                toggleLoader(true);
                await updateDoc(doc(db, "study_items", id), { name: newName });
                toggleLoader(false);
            }
        };

        // --- [DELETE] ลบข้อมูล ---
        window.deleteItem = async (id) => {
            const result = await Swal.fire({
                title: 'ยืนยันการลบ?',
                text: "ข้อมูลจะถูกลบออกจากระบบถาวร",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#f72585',
                confirmButtonText: 'ลบเลย!',
                cancelButtonText: 'ยกเลิก'
            });

            if (result.isConfirmed) {
                toggleLoader(true);
                await deleteDoc(doc(db, "study_items", id));
                toggleLoader(false);
                Swal.fire('Deleted!', 'ลบข้อมูลเรียบร้อยแล้ว', 'success');
            }
        };

    </script>
</body>
</html>
